#!/bin/bash

#shellcheck source=/dev/null
. ~/.config/miscxrdb/fzf/fzf.config

dir="$HOME/.config/rofi/menu"
theme="styles/snippets"
rofi_command="rofi -theme $dir/$theme"

is_path_exits() {
  if [[ ! -f "$1" ]]; then
    dunstify "[!] Showlinuxhelp" "path $1 not exists or deleted!"
    exit
  fi
}

aliases() {
  BASHRC_PATH="$HOME/.config/bashrc/aliases.bashrc"
  is_path_exits "$BASHRC_PATH"
  awk '/\(\)/&& last {print $1,"\t",last} {last=""} /^#/{last=$0}' "$BASHRC_PATH" | sed 's/#//' | sed 's/()//' |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
surfingkeys() {
  SURFINGKEYS_PATH="$HOME/.config/surfingkeys/guidekeys.conf"
  is_path_exits "$SURFINGKEYS_PATH"
  awk '/^[a-zA-Z?.]/ && last {print $1,$2,"\t",last} {last=""} /^#/{last=$0}' "$SURFINGKEYS_PATH" | sed 's/#//' | sort |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
vimiumc() {
  VIMIUMC_PATH="$HOME/.config/vimmum-c/vimium_c.rc"
  is_path_exits "$VIMIUMC_PATH"
  awk '/^[a-zA-Z?.]/ && last {print $1,$2,"\t",last} {last=""} /^#/{last=$0}' "$VIMIUMC_PATH" | sed 's/#//' |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
calcurse() {
  CALCURE_PATH="$HOME/.calcurse/keys"
  is_path_exits "$CALCURE_PATH"
  awk '/^[a-z]/ && last {print $1,$2,"\t",last} {last=""} /^/{last=$0}' "$CALCURE_PATH" |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
ncmpcpp() {
  NCMPCPP_PATH="$HOME/.config/ncmpcpp/bindings"
  is_path_exits "$NCMPCPP_PATH"
  awk '/^[a-zA-Z]/ && last {print $2,"\t",last} {last=""} /^#/{last=$0}' "$NCMPCPP_PATH" | sed 's/#//' |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
newsboat() {
  NEWSBOAT_PATH="$HOME/.newsboat/helpmappings"
  is_path_exits "$NEWSBOAT_PATH"
  awk '/^[a-z]/ && last {print $2,"\t",last} {last=""} /^#/{last=$0}' "$NEWSBOAT_PATH" | sed 's/#//' |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
sxhkdrc() {
  SXHKDRC_PATH="$HOME/.config/sxhkd/sxhkdrc"
  is_path_exits "$SXHKDRC_PATH"
  awk '/^[a-zA-Z]/ && last {print $0,"\t",last} {last=""} /^#/{last=$0}' <"$SXHKDRC_PATH" | sed 's/#//' |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
tmux() {
  TMUX_PATH="$HOME/.tmux.conf"
  is_path_exits "$TMUX_PATH"
  awk '/^[a-z]/ && last {
  if ($2 == "-n")
    print $1,$3,"\t",last;
  else if ($2 == "-r")
    print $1,$3,"\t",last;
  else if ($2 == "-T")
    print $1,$3,$4,"\t",last;
  else
    print $1,$2,"\t",last;
  }
  {last=""} /^#/{last=$0}' "$TMUX_PATH" |
    awk -F"#" '{print $2}' | awk -F"(" '{printf "%s %s\n", $2,$1}' | sort |
    column -t -s ")" | $rofi_command -dmenu -p "snippet[$1]"
}
zathura() {
  ZATHURA_PATH="$HOME/.config/zathura/zathurarc"
  is_path_exits "$ZATHURA_PATH"
  awk '/^[a-z]/ && last {print $1,$2,"\t",last} {last=""} /^#/{last=$0}' "$ZATHURA_PATH" | sed 's/#//' |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
terminal_st() {
  ST_TERMINAL_PATH="$HOME/.config/miscxrdb/terminal/st/binding"
  is_path_exits "$ST_TERMINAL_PATH"
  awk '/^[a-zA-Z]/ && last {print $2,"\t",last} {last=""} /^#/{last=$0}' "$ST_TERMINAL_PATH" | sed 's/#//' |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
terminal_alacritty() {
  ALACRITTY_TERMINAL_PATH="$HOME/.config/miscxrdb/terminal/binding/alacritty"
  is_path_exits "$ALACRITTY_TERMINAL_PATH"
  awk '/^[a-zA-Z]/ && last {print $2,"\t",last} {last=""} /^#/{last=$0}' "$ALACRITTY_TERMINAL_PATH" |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
terminal_kitty() {
  KITTY_TERMINAL_PATH="$HOME/.config/kitty/mappings.conf"
  is_path_exits "$KITTY_TERMINAL_PATH"
  awk '/^[a-zA-Z]/ && last {print $2,"\t",last} {last=""} /^#/{last=$0}' "$KITTY_TERMINAL_PATH" | sed 's/#//' |
    column -t -s $'\t' | $rofi_command -dmenu -p "snippet[$1]"
}
vim() {
  OUT="$HOME/.cache/vimsnipets.sh"
  mystat=$(grep -i "^Plug" <"$HOME/.config/nvim/plugins.vim" | cut -d"/" -f2 | cut -d"'" -f1 | xargs)

  filepath=""
  for v in $mystat; do
    if [ -f "$HOME/.config/nvim/after/plugin/$v.vim" ]; then
      filepath+="$HOME/.config/nvim/after/plugin/$v.vim "
    fi
  done

  cat <<-EOF >"$OUT"
		main () {
		  awk '
		    /^[a-z_ ]/ && last {
		    if (\$2 == "<silent>")
		      if (\$3 == "<buffer>")
		        print \$1,\$4"\\t\\t -",last;
		      else if (\$3 == "<expr>")
		        print \$1,\$4"\\t\\t -",last;
		      else
		        print \$1,\$3"\\t\\t -",last;
		    else if (\$2 == "<expr>")
		        print \$1,\$3"\\t\\t -",last;
		    else
		        print \$1,\$2"\\t\\t -",last;
		    }
		  {last=""}
		  /keymap/ {last=\$0}' ~/.config/vimlocal/mapping.vim \\
		    $filepath \\
		    ~/.config/nvim/plugin/after/*.vim \\
		    ~/Dropbox/data.programming.forprivate/vim-guide/*.vim |
		    sort |
		    sed -e s/\".keymap://g |
		    column -t -s $'\\t' |
		    rofi -width 1000 -dmenu -shorting-method fzf -p "$1"
		}

		main
	EOF

  [[ -f $OUT ]] && bash "$OUT"
}

main() {
  case $1 in
  "aliases") aliases "aliases" ;;
  "calcurse") calcurse "calcurse" ;;
  "ncmpcpp") ncmpcpp "ncmpcpp" ;;
  "newsboat") newsboat "newsboat" ;;
  "surfingkeys") surfingkeys "surfingkeys" ;;
  "sxhkdrc") sxhkdrc "sxhkdrc" ;;
  "term-alacritty") terminal_alacritty "term-alacritty" ;;
  "term-kitty") terminal_kitty "term-kitty" ;;
  "term-st") terminal_st "term-st" ;;
  "term-termite") terminal_termite "term-termite" ;;
  "tmux") tmux "tmux" ;;
  "vim") vim "vim" ;;
  "vimium") vimiumc "vimium_c" ;;
  "zathura") zathura "zathura" ;;
  *) dunstify "...what are you doing?" ;;

  esac
}

main "$1"
